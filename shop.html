<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Shop - Get Your Upgrades!</title>
    <link rel="stylesheet" href="styles/homepage.css">
    <link rel="stylesheet" href="styles/shop.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="main-container shop-container">

        <div class="shop-header">
            <h1 class="welcome-heading welcome-text">Casino Royale Shop</h1>
            <p class="intro-paragraph">
                Enhance your gameplay! Special offers and exclusive items await.
                <span class="current-chips">Your Chips: <span id="player-chip-balance">0</span> ğŸª™</span>
            </p>
            <a href="index.html" class="casino-btn back-to-casino-btn">â† Back to Casino</a>
        </div>

        <h2 class="game-choice-heading shop-section-heading">Featured Items</h2>

        <div class="shop-items-grid">
            <div class="shop-item" id="item-stash-10k">
                <div class="item-image-placeholder">
                    <img src="assets/chip_bundle_large.png" alt="Large Chip Bundle">
                </div>
                <h3 class="item-name">High Roller's Stash</h3>
                <p class="item-description">Get a massive boost with 10,000 Chips!</p>
                <div class="item-price">
                    <span class="price-value">10,000</span> <span class="currency-icon">ğŸª™</span>
                </div>
                <button type="button" class="casino-btn buy-btn primary-action-btn" data-item-id="stash_10k" data-price="10000" data-currency="chips" data-item-name="High Roller's Stash" data-item-type="chips" data-chip-amount="10000">Buy Now</button>
                <span class="item-tag popular-tag">ğŸ”¥ Popular!</span>
            </div>

            <div class="shop-item" id="item-gold-card">
                <div class="item-image-placeholder">
                     <img src="assets/gold_card_skin.png" alt="Gold Card Skin">
                </div>
                <h3 class="item-name">Golden Card Back</h3>
                <p class="item-description">Show off your style with this exclusive card skin.</p>
                <div class="item-price">
                    <span class="price-value">2,500</span> <span class="currency-icon">ğŸª™</span>
                </div>
                <button type="button" class="casino-btn buy-btn" data-item-id="gold_card" data-price="2500" data-currency="chips" data-item-name="Golden Card Back" data-item-type="skin">Get Item</button>
            </div>

            <div class="shop-item limited-offer" id="item-mystery-box">
                <div class="item-image-placeholder">
                    <img src="assets/mystery_box.png" alt="Mystery Box">
                </div>
                <h3 class="item-name">Mystery Box <span class="timer-text" id="mystery-box-timer">(10:00)</span></h3>
                <p class="item-description">Contains a random rare item or a huge chip prize!</p>
                <div class="item-price">
                    <span class="price-value original-price">1,500</span>
                    <span class="price-value sale-price">1,000</span> <span class="currency-icon">ğŸª™</span>
                </div>
                <button type="button" class="casino-btn buy-btn primary-action-btn" data-item-id="mystery_box" data-price="1000" data-currency="chips" data-item-name="Mystery Box" data-item-type="lootbox">Snag Deal!</button>
                <span class="item-tag limited-tag">â³ Limited Time!</span>
            </div>

            <div class="shop-item" id="item-starter-pack">
                <div class="item-image-placeholder">
                    <img src="assets/chip_bundle_small.png" alt="Small Chip Bundle">
                </div>
                <h3 class="item-name">Starter Pack</h3>
                <p class="item-description">A quick top-up of 500 Chips.</p>
                <div class="item-price">
                    <span class="price-value">500</span> <span class="currency-icon">ğŸª™</span>
                </div>
                <button type="button" class="casino-btn buy-btn" data-item-id="starter_pack" data-price="500" data-currency="chips" data-item-name="Starter Pack" data-item-type="chips" data-chip-amount="500">Add Chips</button>
            </div>
        </div>

        <h2 class="game-choice-heading shop-section-heading">Special Bundles</h2>
        <div class="shop-items-grid">
            <div class="shop-item" id="item-vip-pass">
                <div class="item-image-placeholder">
                     <img src="assets/vip_pass.png" alt="VIP Pass">
                </div>
                <h3 class="item-name">VIP Monthly Pass</h3>
                <p class="item-description">Daily chip bonuses, exclusive tables, and more!</p>
                <div class="item-price">
                     <span class="price-value">$19.99/month</span> </div>
                <button type="button" class="casino-btn buy-btn primary-action-btn best-value-btn" data-item-id="vip_pass" data-price="19.99" data-currency="usd" data-item-name="VIP Monthly Pass" data-item-type="subscription">Become VIP</button>
                 <span class="item-tag best-value-tag">ğŸ’ Best Value!</span>
            </div>
        </div>
    </div>

    <script>
        // --- Global State & Configuration ---
        let playerChips = 0; // This will be loaded, e.g., from localStorage or an API
        const chipBalanceElement = document.getElementById('player-chip-balance');
        const MYSTERY_BOX_DURATION_SECONDS = 10 * 60; // 10 minutes for the timer

        // --- Utility Functions ---
        function formatChipCount(chips) {
            return chips.toLocaleString(); // Adds commas for thousands
        }

        function updateChipDisplay() {
            if (chipBalanceElement) {
                chipBalanceElement.textContent = formatChipCount(playerChips);
            }
        }

        function showNotification(message, type = 'info') {
            // In a real app, you'd use a more sophisticated notification system (e.g., a toast library)
            console.log(`[${type.toUpperCase()}] ${message}`);
            alert(message); // Simple alert for now
        }

        // --- Initialization ---
        function initializeShop() {
            // Try to load chips from localStorage for basic persistence
            const savedChips = localStorage.getItem('playerCasinoChips');
            if (savedChips !== null) {
                playerChips = parseInt(savedChips, 10);
            } else {
                // Default starting chips if nothing is saved (e.g., for a new player)
                playerChips = 5000; // Example starting balance
                localStorage.setItem('playerCasinoChips', playerChips.toString());
            }
            updateChipDisplay();
            startMysteryBoxTimer(MYSTERY_BOX_DURATION_SECONDS);
            setupEventListeners();
        }

        // --- Event Listeners ---
        function setupEventListeners() {
            document.querySelectorAll('.buy-btn').forEach(button => {
                button.addEventListener('click', handlePurchaseAttempt);
            });
        }

        // --- Purchase Logic ---
        function handlePurchaseAttempt(event) {
            const button = event.currentTarget;
            const itemId = button.dataset.itemId;
            const itemName = button.dataset.itemName;
            const price = parseFloat(button.dataset.price);
            const currency = button.dataset.currency;
            const itemType = button.dataset.itemType; // e.g., 'chips', 'skin', 'subscription'
            const chipAmount = parseInt(button.dataset.chipAmount, 10) || 0; // Amount of chips this item gives

            console.log(`Attempting purchase: ${itemName} (ID: ${itemId}) for ${price} ${currency}`);

            if (currency === 'chips') {
                if (playerChips >= price) {
                    // Simulate backend call for chip-based purchase
                    // MOCK_processChipPurchaseOnBackend(itemId, price)
                    // .then(success => { if(success) { ... } })
                    
                    playerChips -= price;
                    if (itemType === 'chips') {
                        playerChips += chipAmount; // Add chips if it's a chip bundle
                    }
                    
                    localStorage.setItem('playerCasinoChips', playerChips.toString());
                    updateChipDisplay();
                    showNotification(`Successfully purchased ${itemName}!`, 'success');
                    // TODO: Add item to player's inventory (client-side representation or backend call)
                    console.log(`BACKEND CALL SIMULATION: processPurchase(user, ${itemId}, ${price} chips)`);

                } else {
                    showNotification('Not enough chips for this item!', 'error');
                }
            } else if (currency === 'usd') {
                // Real money transaction (e.g., VIP Pass)
                showNotification(`Initiating purchase for ${itemName} for $${price}. \nRedirecting to payment provider... (simulation)`, 'info');
                // TODO: Integrate with a real payment gateway (Stripe, PayPal, Braintree)
                // This would involve:
                // 1. Calling your backend to create a payment session/intent.
                // 2. Redirecting the user to the payment provider or using their SDK.
                // 3. Handling the payment confirmation callback from your backend.
                console.log(`BACKEND CALL SIMULATION: createPaymentIntent(user, ${itemId}, ${price} USD)`);
            } else {
                showNotification('Unknown currency type.', 'error');
            }
        }

        // --- Mystery Box Timer ---
        let mysteryBoxInterval;
        function startMysteryBoxTimer(durationSeconds) {
            const timerElement = document.getElementById('mystery-box-timer');
            if (!timerElement) return;

            let timeLeft = durationSeconds;

            // Clear any existing interval to prevent multiple timers
            if (mysteryBoxInterval) {
                clearInterval(mysteryBoxInterval);
            }

            mysteryBoxInterval = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(mysteryBoxInterval);
                    timerElement.textContent = "(Expired!)";
                    // Optionally disable the buy button for the mystery box
                    const mysteryBoxButton = document.querySelector('button[data-item-id="mystery_box"]');
                    if (mysteryBoxButton) {
                        mysteryBoxButton.disabled = true;
                        mysteryBoxButton.textContent = "Deal Expired";
                    }
                } else {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    timerElement.textContent = `(${minutes}:${seconds < 10 ? '0' : ''}${seconds})`;
                    timeLeft--;
                }
            }, 1000);
        }

        // --- Document Ready ---
        // Ensures the DOM is fully loaded before running scripts
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeShop);
        } else {
            initializeShop(); // DOMContentLoaded has already fired
        }

    </script>
</body>
</html>